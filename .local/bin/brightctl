#!/bin/sh

# Brightctl, a simple switch that uses sysfs to manage the display brightness. See also: Brightnessctl.
# Run it with doas, or have the user own the brightness file.

arg="$*"
echo "$arg"

bl="$(
    ls /sys/class/backlight |
    awk '{print $1}'
)"

brightness=$(cat /sys/class/backlight/"$bl"/brightness)

saved="$HOME/.local/share/brightness"
oldbrightness="$brightness"

upstep=$(
    cat /sys/class/backlight/"$bl"/max_brightness
)

echo "Was $oldbrightness"

case "$arg" in
    +)       _=$((brightness=(brightness+5) )) ;;
    -)       _=$((brightness=(brightness-6) )) ;;
    -s)      (echo "$brightness" > "$HOME"/.local/share/brightness &&
                 echo Saved "$saved" as "$brightness" ||
                 echo "Failed. Check your privilege.")
                     ;;
    -r | restore | --restore ) brightness=$(cat "$saved")
esac

echo "$brightness" > /sys/class/backlight/"$bl"/brightness 2>/dev/null &&
echo Now "$brightness" ||
    echo Still "$oldbrightness"\, maybe don\'t expect the impossible next time?
